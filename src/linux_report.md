# Операционные системы UNIX/Linux (Базовый).
Установка и обновления системы Linux. Основы администрирования.

## Contents
1 [Установка ОС](#part-1-установка-ос)  
2 [Создание пользователя](#part-2-создание-пользователя)  
3 [Настройка сети ОС](#part-3-настройка-сети-ос)   
4 [Обновление ОС](#part-4-обновление-ос)  
5 [Использование команды  sudo](#part-5-использование-команды-sudo)  
6 [Установка и настройка службы времени](#part-6-установка-и-настройка-службы-времени)  
7 [Установка и использование текстовых редакторов](#part-7-установка-и-использование-текстовых-редакторов)  
8 [Установка и базовая настройка сервиса SSHD](#part-8-установка-и-базовая-настройка-сервиса-sshd)   
9 [Установка и использование утилит top, htop](#part-9-установка-и-использование-утилит-top-htop)   
10 [Использование утилиты fdisk](#part-10-использование-утилиты-fdisk)   
11 [Использование утилиты df](#part-11-использование-утилиты-df)   
12 [Использование утилиты du](#part-12-использование-утилиты-du)   
13 [Установка и использование утилиты ncdu](#part-13-установка-и-использование-утилиты-ncdu)    
14 [Работа с системными журналами](#part-14-работа-с-системными-журналами)     
15 [Использование планировщика заданий CRON](#part-15-использование-планировщика-заданий-cron)    

## Part-1-установка-ос
- 
   Установка состоит из основных шагов:   
   Загрузка образа   
   Запись на загрузочный носитель   
   Запуск установщика образа   
   Выбор языка   
   Обновление загрузщика(опционально)   
   Настройка: раскладки, сети, прокси, ssh, выбор сервера репозитория   
   Разметка диска   
   Создание пользователя, настройка имени машины   
   Выбор приложений для установки   
   
   После завершения установки и перезагрузки, авторизуемся в системе,вводя логин и пароль.   
   Для того, чтобы проверить версию ОС:   
   
   ![linux](https://i.ibb.co/Z6jtXhm/1-1.png "Cкриншот с выводом версии системы")
   
## Part-2-создание-пользователя
-
   Вся информация о пользователях находится в файле `/etc/passwd`.
   Команда useradd позволяет зарегистрировать нового пользователя или
   изменить информацию об уже имеющемся.
   **useradd опции имя_пользователя**
   
   В Linux есть довольно значительное количество системных групп. Их
   предназначение заключается в распределении доступа к системным
   ресурсам. Группа adm предоставляет доступ к директории `/var/log/` 

   ![linux](https://i.ibb.co/2Pqpqkk/Screenshot-1.png "`добавление юзера, и вывод информации о всех пользователях в системе`")

## Part-3-настройка-сети-ос

 - ##### Задать название машины вида пользователь_1 (имя пользователя из Part 2): 
 
     ![linux](https://i.ibb.co/j8HSGZH/Screenshot-3.png "`текущее имя компьютера`")
        
      Посмотреть текущее имя компьютера можно выполнив команду    **hostnamectl**.
      Для изменения **hostnamectl set-hostname    'новое имя'**
       
      Если, по каким-либо причинам, новое имя не начнет использоваться, перезагружаемся или вводим:
      systemctl restart systemd-hostnamed
        
- ##### Установка временной зоны: 
  Проверить текущее системное время можно с помощью утилиты `date`
  Наиболее популярный и поддерживаемый в большинстве дистрибутивов способ установки часового пояса для всех пользователей - с помощью символической  ссылки `/etc/localtime` на файл нужного часового пояса.
  Список доступных часовых поясов можно посмотреть командой: `ls /usr/share/zoneinfo/`, текущий часовой пояс через `ls -l /etc/localtime`.

  Для создания символической ссылки используйте  команду `ln -sf`
  **-f** - удалять существующие ссылки
  **-s** - создать символическую ссылку
  
  Файл зоны нужно выбрать из доступных в системе. *ln опции файл_источник файл_ссылки*
  
  ![linux](https://i.ibb.co/GvSr92h/Screenshot-4.png "``")
  
  Установка временной зоны
	
- ##### Вывод названия сетевых интерфейсов с помощью консольной команды: 

  Интерфейсом с точки зрения ОС является устройство, через которое система получает и передает IP-пакеты. 
  Наиболее часто для отображения сетевых интерфейсов используется программа **ifconfig** (ее название происходит от “interface configuration”). Но команда ‘ifconfig’ устарела в последних версиях Linux.
  Поэтому вы можете использовать команду ‘ip’ - `ip link show` или `ip -s    link`.

  ![linux](https://i.ibb.co/ZBjfkB0/Screenshot-5.png"``")

  Тогда вы в ответ можете получить информацию о параметрах вашей  Ethernet-карты и так называемого “кольцевого интерфейса” или “обратной петли” – Local Loopback (интерфейс Ethernet при единственной сетевой карте обозначается как eth0, а кольцевой интерфейс – как lo).
  Он может быть использован сетевым клиентским программным обеспечением, чтобы общаться с серверным приложением, расположенным на том же компьютере. 
  То есть если на компьютере, на котором запущен веб-сервер, указать в веб-браузере URL http://127.0.0.1/ или http://localhost/, то он попадает на веб-сайт этого компьютера.

   
- ##### Для получения ip адреса устройства от DHCP сервера.

  Cетевые настройки осуществляются с помощью     редактирования  - `sudo nano /etc/netplan/00-installer-config.yalm`
    
  ![linux](https://i.ibb.co/zGSHNhN/Screenshot-6.png"``")
            
  Для применения настроек выполнить `sudo netplan    generate`, и `sudo netplan apply`   
  
  ![linux](https://i.ibb.co/d4FnwfJ/Screenshot-12.png"``")  
       
- ##### Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw):
   
  внешний ip-адрес - `curl ifconfig.co`

  ![linux](https://i.ibb.co/GRCmWJG/Screenshot-10.png"``")
    
  внутренний IP-адрес шлюза -       `ip route show | grep default`

  ![linux](https://i.ibb.co/DgjbVWr/Screenshot-13.png"``")  
  (первое число)

- ##### Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns:
  C помощью редактирования  конфигурации netplan  - `sudo nano /etc/netplan/00-installer-config.yalm`
   
  ![linux](https://i.ibb.co/QD2NHKF/Screenshot-14.png"``")
   		
  Применив через `sudo netplan generate` , перезагружаем через `reboot`
 
- ##### Перезагрузить виртуальную машину. Убедиться, что  статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем    пункте.
  
  ![linux](https://i.ibb.co/BNqRpGs/Screenshot-16.png"``")

## Part-4-обновление-ос

 - ##### Обновить систему до последней версии.
    Команда apt update обновляет индекс пакетов в системе Linux или списки пакетов.
    Индексный файл пакетов – это файл или база данных, которые содержат список программных пакетов, определенных в репозиториях, расположенных в файле /etc/apt/sources.list.

    ![linux](https://i.ibb.co/fts7WVR/Screenshot-17.png"``")

    Команда apt upgrade обновляет пакеты до последних версий и устанавливает новые пакеты, если они требуются в качестве зависимостей.
    Он не удаляет никакие пакеты, а если какие-либо из них предназначены для удаления, он их пропускает. А при apt full-upgrade, удаляются старые версии обновленных программ.

    ![linux](https://i.ibb.co/tQSYgSw/Screenshot-18.png"``")

   
## Part-5-использование-команды-sudo
- ##### Разрешить пользователю, созданному в [Part 2](#part-2-создание-пользователя), выполнять команду sudo.

  **Sudo** (англ.**S**ubstitute **U**ser and **do**, дословно «подменить пользователя и выполнить») — программа для системного администрирования UNIX-систем, позволяющая делегировать те или иные привилегированные ресурсы пользователям с ведением протокола работы.
  Основная идея — дать пользователям как можно меньше прав, при этом достаточных для решения поставленных задач.
  **Sudo** - это альтернатива su для выполнения команд с правами суперпользователя (root). В отличие от su который запускает оболочку с правами root и даёт всем дальнейшим командам root права, sudo предоставляет временное повышение привилегий для одной команды.
  Предоставляя привилегии root только при необходимости, использование sudo снижает вероятность того, что опечатка или ошибка в выполняемой команде произведут в системе разрушительные действия.

- Поменять hostname ОС от имени пользователя, созданного в пункте [Part 2](#part-2-создание-пользователя). (используя sudo).
    
  Сперва добавим пользователя в список `/etc/sudoers` Это делается с помощью команды `visudo` Синтаксис такой - [username][any-hostname]=([run-as-username]:[run-as-groupname]) [commands-allowed]

  Из под юзера с админ правами редактируем конфиг sudoers:
  ![linux](https://i.ibb.co/mrKvG3P/Screenshot-21.png "")

  Разлогиниваемся через `logout`, и заходим на 2ого пользователя, и
  проверяем что имя хоста меняется
  ![linux](https://i.ibb.co/jhkdCvk/Screenshot-20.png "")

## Part-6-установка-и-настройка-службы-времени

 - ##### Настроить службу автоматической синхронизации времени.
    В большинстве дистрибутивов Linux используется [systemd](https://ru.wikipedia.org/wiki/Systemd), а вместе с ним и демон systemd-timesyncd.
    Это означает, что у вас уже есть NTP-клиент, предварительно установленный в Ubuntu и других. На этих дистрибутивах чтобы проверить, включена ли синхронизация NTP запустите команду `timedatectl`
    
    Теперь настроим systemd-timesyncd, для этого в файл конфигурации /etc/systemd/timesyncd.conf пропишем список серверов времени:
    `sudo nano /etc/systemd/timesyncd.conf`
      
    ![linux](https://i.ibb.co/fS3j1BR/Screenshot-22.png"``")

    Включаем использование systemd-timesyncd для синхронизации времени:
    `timedatectl set-ntp true`

    Включаем и перезапускаем службу systemd-timesyncd: 

    `systemctl enable --now systemd-timesyncd.service`

    `systemctl restart systemd-timesyncd.service`

    Проверяем статус: `systemctl status systemd-timesyncd.service`

    ![linux](https://i.ibb.co/48MJSGr/Screenshot-23.png"``")

    Запустив `timedatectl status` в успешном случае в строке NTP service должно быть yes
    ![linux](https://i.ibb.co/S5x1Rx5/Screenshot-24.png"``")

## Part-7-установка-и-использование-текстовых-редакторов

 - ##### Установить текстовые редакторы **VIM** , **NANO**, **MCEDIT**.
    Устанавливаем нужные приложения через `sudo apt-get install`
   
- ##### Используя каждый из трех выбранных редакторов, создайте файл *test_X.txt*, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.

  **VIM**

    Открываем vim и создаём файл командой - vim test_vim.txt
        
    Пишем данные, сохраняем  **:w**, закрываем **:q**
            
    ![linux](https://i.ibb.co/pZ9qL65/Screenshot-26.png"``")

  
  **NANO**

    Открываем nano и создаём файл командой -  nano test_nano.txt
    
    Жмём Ctrl + O для сохранения, Ctrl + X для выхода

    ![linux](https://i.ibb.co/yBt6svr/Screenshot-25.png"``")
    
  **MCEDIT**

    Открываем mcedit и создаём файл командой - `mcedit test_mcedit.txt`

    Жмём F2 для сохранения, подтверждаем изменения и имя файла, F10 для выхода
      
    ![linux](https://i.ibb.co/wNy8cbW/Screenshot-27.png"``")
    
- ##### Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.
   
  **VIM**
    Для выделения слова вводим `vw`, ввести нужную строку вручную или вставить из буфера(если она там есть)
    **Вставить** - `p`
    **:q!** - закрыть редактор без сохранения
  
    ![linux](https://i.ibb.co/Px3XfFK/Screenshot-28.png"``")

  **NANO**
    Перемещаем курсор на начало слова CTRL+ ЛЕВО\ПРАВО, удаляем на del, ввести нужную строку вручную или вставить из буфера(если она там есть)
    **Вставить** - `Ctrl-u`
    Ctrl + X для выхода, N для без сохранения;
  
    ![linux](https://i.ibb.co/0G33PBs/Screenshot-32.png"``")

  **MCEDIT**
    Перемещаем курсор на начало слова CTRL+ ЛЕВО\ПРАВО, удаляем на del,  ввести нужную строку вручную или вставить из
    буфера(если она там есть)
    **Вставить** - `insert`
    **F10** - закрыть редактор, отказаться от сохранения перед закрытием выбрав `No`
    ![linux](https://i.ibb.co/RQKFJMQ/Screenshot-31.png"``")

- ##### Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.

    **VIM** 
    
    Для поиска и замены:`:%s/искать/заменить/g`
    
    Для поиска:  `/шаблон` . **n** - продолжить поиск вперед, **N** - продолжить поиск назад
    
    ![linux](https://i.ibb.co/Px3XfFK/Screenshot-28.png"``")
    ![linux](https://i.ibb.co/020fwr5/Screenshot-38.png"``")

    **NANO**
    
    Для поиска и замены: `ALT + R`
    
    ![linux](https://i.ibb.co/QQzq49H/Screenshot-29.png"``")

    Поиск- Ctrl-w Найти следующее вхождение - Alt-w или Ctrl-w Enter

    ![linux](https://i.ibb.co/sJCwjLq/Screenshot-39.png"``")


    **MCEDIT**
    
    Для поиска и замены:`F4`, ввести искомую и строку замены, подтвердить замену

    ![linux](https://i.ibb.co/mGvJ9xD/Screenshot-35.png"``")
    Заменилось
    =) ![linux](https://i.ibb.co/QYwMc7g/Screenshot-36.png"``")
    Просто для поиска  `F7`
    ![linux](https://i.ibb.co/ZKtVXqF/Screenshot-37.png"``")

## Part-8-установка-и-базовая-настройка-сервиса-sshd  
- ##### Установить службу SSHd.  Для установки ssh службы `sudo apt install openssh-server`
   
    После завершения установки служба SSH запустится автоматически. Вы
    можете проверить, работает ли SSH, набрав: `systemctl status sshd`
    
    Если не запущена, попробовать запустить- `sudo systemctl start ssh`
    
    Если вы хотите чтобы служба запускалась автоматически нужно добавить
    его в автозагрузку, набрав: `sudo systemctl enable ssh`
    ![linux](https://i.ibb.co/xJxp6Sn/Screenshot-40.png"``")
    
    ##### Перенастроить службу SSHd на порт 2022.  Все настройки сервера SSH хранятся в конфигурационном файле `/etc/ssh/sshd_config`
    
    Чтобы сменить порт меняем значение в строчке Port. 	-_-
    ![linux](https://i.ibb.co/wYTpz38/Screenshot-43.png"``")
    
    Еще можно разрешить этот порт для правил фаирвола `sudo ufw allow
    2022/tcp`
    
- ##### Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи. ps утилита для просмотра списка
    процессов в Linux. Флаг **-С** - выбрать процессы по имени команды;
    
    Чтобы выбрать процесс по имени : `ps -C sshd`
    
    ![linux](https://i.ibb.co/xs3K1k6/Screenshot-42.png"``")
    
    
- ##### Перезагрузить систему.
    
    Перезагружаемся - `reboot`
    
    Для установки netstat  `sudo apt install net-tools`
    
    Проверяем, вывод команды netstat -tan должен содержать   `tcp 0 0
    0.0.0.0:2022 0.0.0.0:* LISTEN` 

  ![linux](https://i.ibb.co/LPCyBM4/Screenshot-45.png"``")
    
- #### значение столбцов вывода

    Proto > Протокол (tcp, udp, raw), используемый сокетом.
    
    Recv-Q > Счётчик байт не скопированных программой пользователя из
    этого сокета.
    
    Send-Q > Счётчик байтов, не подтверждённых удалённым узлом.
    
    Local Address > Адрес и номер порта локального конца сокета. Если не
    указана опция **--numeric** (**-n**), адрес сокета преобразуется в
    каноническое имя узла (FQDN), и номер порта преобразуется в
    соответствующее имя службы.
    
    Foreign Address > Адрес и номер порта удалённого конца сокета.
    Аналогично "Local Address."
    
    State > Состояние сокета.
    
 - #### значение ключей 
    -t по протоколу TCP
    -a показывать состояние всех сокетов;
    -n показывать сетевые адреса как числа
    
 - #### значение  0.0.0.0
    
    **0.0.0.0** — это самый первый IP адрес. Но он относится к IP специального назначения (как например 127.0.0.1) и выполняет разные
    функции.
    
    Когда говорят о прослушиваемых портах, это обозначение в Linux
    символизирует заполнитель, то есть означает «любой IP адрес».
    
    В программе **netstat** также используется запись **0.0.0.0:***
    которая также обозначает «любой IPv4 адрес с любого порта».

## Part-9-установка-и-использование-утилит-top-htop

 - ##### Установить и запустить утилиты top и htop.  
   
       sudo apt install top
       sudo apt install htop
    
  - **top** 
   
    ![linux](https://i.ibb.co/pZ48cQW/Screenshot-46.png"``")

   
   Если нажать P, список процессов отсортируется по памяти, в первом
   столбце первой строчки будет pid процесса занимающего больше всего
   процессорного времени  Если нажать M, список процессов отсортируется
   по памяти, в первом столбце первой строчки будет pid процесса
   занимающего больше всего памяти
   
 - **htop**, сортировка по:
   
      PID

      ![linux](https://i.ibb.co/R4kjJM9/Screenshot-47.png"``")
     
      PERCENT_CPU

      ![linux](https://i.ibb.co/z5QDtWN/Screenshot-49.png"``")
     
      PERSENT_MEM

      ![linux](https://i.ibb.co/18VJbDg/Screenshot-50.png"``")
     
      TIME

      ![linux](https://i.ibb.co/479c73Z/Screenshot-51.png"``")
      
      отфильтровано для процесса sshd

      ![linux](https://i.ibb.co/gZjPTHm/Screenshot-52.png"``")
    
      с процессом syslog, найденным, используя поиск

      ![linux](https://i.ibb.co/h8bbzyQ/Screenshot-53.png"``")
      
      с добавленным выводом hostname, clock и uptime

      ![linux](https://i.ibb.co/3C294xw/Screenshot-54.png"``")

## Part-10-использование-утилиты-fdisk

 - ##### Запустить команду `sudo fdisk -l.`

    ![linux](https://i.ibb.co/6yx5PMk/Screenshot-55.png"``")

        название жесткого диска: VBOX HARDDISK
        его размер : 20.63 GiB
        количество
        секторов 43228544
        размер swap 1G

## Part-11-использование-утилиты-df 

 - ##### Запустить команду df для корневого раздела (/) 

    ![linux](https://i.ibb.co/HFt0QyX/Screenshot-56.png"``")
        
        - размер раздела 10255636
        - размер занятого пространства 5321564
        - размер свободного пространства 4393400
        - процент использования 55%
        - единица измерения в выводе - килобайт.  
      

    ##### Запустить команду df -Th для корневого раздела (/)

      ![linux](https://i.ibb.co/Yt3xJ0Z/Screenshot-57.png"``")
          
        - размер раздела 9.8G
        - размер занятого пространства 5.1G
        - размер свободного пространства 4.2G
        - процент использования 55%
        - тип файловой системы для раздела ext4

## Part-12-использование-утилиты-du 

 - ##### Запустить команду du.
   
   ##### Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде) 
   
   ![linux](https://i.ibb.co/b2pMJxL/Screenshot-63.png"``")

   ##### Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *) 

   ![linux](https://i.ibb.co/rHdkxzd/Screenshot-59.png"``")

 
## Part-13-установка-и-использование-утилиты-ncdu

 - ##### Установить утилиту ncdu.
   
       sudo apt install ncdu
   
   ##### Вывести размер папок /home, /var, /var/log. sudo ncdu **  

    ![linux](https://i.ibb.co/WBMst5B/Screenshot-60.png"``")
      
    ![linux](https://i.ibb.co/d6YZH3c/Screenshot-61.png"``")
      
    ![linux](https://i.ibb.co/GM05cxp/Screenshot-62.png"``")

  
## Part-14-работа-с-системными-журналами

 - ##### Открыть для просмотра:
   ##### 1. /var/log/dmesg
   ##### 2. /var/log/syslog
   ##### 3. /var/log/authlog  
   
   Открыть файлы можно через текстовые редакторы, либо через утилиту для
   просмотра логов lnav
   
   Чтобы найти время последней успешной авторизации можно искать слова
   Accepted password, либо утилитой last или lastlog
   
   ![linux](https://i.ibb.co/zmGpFfs/Screenshot-64.png"``") 
   
   время последней успешной авторизации 19.00.18
   имя пользователя sfleta
   метод входа в систему ssh2
   
	Перезапустить службу SSHd - `sudo systemctl restart ssh`

	в syslog - сообщение о рестарте службы

	 ![linux](https://i.ibb.co/8mXyD6j/Screenshot-65.png"``")

## Part-15-использование-планировщика-заданий-cron

 - ##### Используя планировщик заданий, запустите команду uptime через каждые 2 минуты. 
  
    Сron это планировщик, который позволяет выполнять
    нужные вам скрипты раз в час, раз в день, неделю или месяц, а также в
    любое заданное вами время или через любой интервал. Для настройки
    времени, даты и интервала когда нужно выполнять задание используется
    специальный синтаксис файла cron и специальная команда. Конечно, вы
    всегда можете отредактировать файл /etc/crontab, но этого делать не
    рекомендуется. Вместо этого, есть команда crontab -e: Синтаксис
    crontab - **минута час день месяц день_недели
    /путь/к/исполняемому/файлу** Чтобы указать не точное время
    выполнения, а интервал, используется разделитель косая черта - "/"
    
    После редактирования, можно проверить, было ли выполнение, в syslog
    
    ![linux](https://i.ibb.co/GnbbHBK/Screenshot-66.png"``")

    
      Посмотреть список текущих задач cron для суперпользователя -
    `crontab -l` 
    
    ![linux](https://i.ibb.co/mz9Y3Yb/Screenshot-68.png"``")

    
    Вы можете удалить все существующие задачи - `crontab -r`
    
    ![linux](https://i.ibb.co/2YyCjSB/Screenshot-69.png"``")


